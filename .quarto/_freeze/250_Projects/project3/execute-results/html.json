{
  "hash": "e17fe048fbc28cdf16fcb29ced5945fa",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Client Report - Late Flights & Missing Data (JSON)\"\nsubtitle: \"Course DS 250\"\nauthor: \"[Maia Faith Chambers]\"\nformat:\n  html:\n    self-contained: true\n    page-layout: full\n    title-block-banner: true\n    toc: true\n    toc-depth: 3\n    toc-location: body\n    number-sections: false\n    html-math-method: katex\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-overflow: wrap\n    code-copy: hover\n    code-tools:\n        source: false\n        toggle: true\n        caption: See code\nexecute: \n  warning: false\n    \n---\n\n::: {#4c5e49d7 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nfrom lets_plot import *\n\nLetsPlot.setup_html(isolated_frame=True)\n```\n:::\n\n\n::: {#bc26d303 .cell execution_count=2}\n``` {.python .cell-code}\n# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html\n\n# Include and execute your code here\ndf = pd.read_json(\"https://github.com/byuidatascience/data4missing/raw/master/data-raw/flights_missing/flights_missing.json\")\n\ndf.columns.to_list()\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\n['airport_code',\n 'airport_name',\n 'month',\n 'year',\n 'num_of_flights_total',\n 'num_of_delays_carrier',\n 'num_of_delays_late_aircraft',\n 'num_of_delays_nas',\n 'num_of_delays_security',\n 'num_of_delays_weather',\n 'num_of_delays_total',\n 'minutes_delayed_carrier',\n 'minutes_delayed_late_aircraft',\n 'minutes_delayed_nas',\n 'minutes_delayed_security',\n 'minutes_delayed_weather',\n 'minutes_delayed_total']\n```\n:::\n:::\n\n\n## Elevator pitch\nThe analysis I did discovers that SLC airport had the highest proportion of delayed flights, February was the most punctual month to travel. Weather-related delays were more prevalent in late summer and winter, with SFO airport experiencing the greatest weather impact.\n\n## QUESTION|TASK 1\n\n__Fix all of the varied missing data types in the data to be consistent (all missing values should be displayed as “NaN”).__ In your report include one record example (one row) from your new data, in the raw JSON format. Your example should display the \"NaN\" for at least one missing value.__  \n\nBy replacing empty string and \"999\" with NaN. This standardizes the data and gets rid of placeholder values and empty strings. It also allows us to handle missing values and makes them easier to identify. The example below is a single row from the data set that has been cleaned and turned into JSON format. \n\n::: {#31fd3c7e .cell execution_count=3}\n``` {.python .cell-code}\n#This code replaces empty string and \"999\" with NaN\ndf_clean= df.replace(['', 999], np.nan)\n\n# Clean airport code formatting right after cleaning the data\ndf_clean['airport_code'] = df_clean['airport_code'].str.strip().str.upper()\n\nexample= df_clean.iloc[[10]].to_json(orient='records', indent = 2)\nprint(example)\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[\n  {\n    \"airport_code\":\"ORD\",\n    \"airport_name\":\"Chicago, IL: Chicago O'Hare International\",\n    \"month\":\"Febuary\",\n    \"year\":2005.0,\n    \"num_of_flights_total\":25665,\n    \"num_of_delays_carrier\":\"794\",\n    \"num_of_delays_late_aircraft\":1222.0,\n    \"num_of_delays_nas\":3132,\n    \"num_of_delays_security\":6,\n    \"num_of_delays_weather\":114,\n    \"num_of_delays_total\":5269,\n    \"minutes_delayed_carrier\":50136.0,\n    \"minutes_delayed_late_aircraft\":72868,\n    \"minutes_delayed_nas\":164398.0,\n    \"minutes_delayed_security\":208,\n    \"minutes_delayed_weather\":7256,\n    \"minutes_delayed_total\":294866\n  }\n]\n```\n:::\n:::\n\n\n## QUESTION|TASK 2\n\n__Which airport has the worst delays?__ Describe the metric you chose, and why you chose it to determine the “worst” airport. Your answer should include a summary table that lists (for each airport) the total number of flights, total number of delayed flights, proportion of delayed flights, and average delay time in hours.   \n\nThe proportion I used to identify the airport with worst delays is the proportion of delayed flights. This is crucial for identifying airports where delays happen often. A small airport would have fewere total minutes of delay but a very high proportion of late departures, which could still make it the \"worst\" from a passenger's perspective. I also used the average delay time in hours so that we can determine how severe the delays are, on average, to get an accurate depiction of airports when delays occur. A hgigher proportion of delays may indicate frequency, average delay time indicaes the intensity.\n\n::: {#e8beba1f .cell execution_count=4}\n``` {.python .cell-code}\n## QUESTION|TASK 2\n\n# Create delay indicator and helper column for average delay\ndf_clean['is_delayed'] = df_clean['minutes_delayed_total'].fillna(0) > 0\ndf_clean['delay_minutes_filled'] = df_clean['minutes_delayed_total'].fillna(0)\n\n# Summary by airport\nsummary = (\n    df_clean.groupby('airport_code')\n    .agg(\n        total_flights=('num_of_flights_total', 'sum'),\n        delayed_flights=('is_delayed', 'sum'),\n        avg_delay_hr=('delay_minutes_filled', lambda x: x.mean() / 60)\n    )\n    .reset_index()\n)\n\nsummary['prop_delayed'] = summary['delayed_flights'] / summary['total_flights']\nsummary = summary.sort_values(by='prop_delayed', ascending=False)\n\n# Optional: Display the summary table\nprint(summary.head())\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  airport_code  total_flights  delayed_flights  avg_delay_hr  prop_delayed\n2          IAD         851571              132   1298.418939      0.000155\n4          SAN         917862              132   1044.980808      0.000144\n6          SLC        1403384              132   1278.203409      0.000094\n5          SFO        1630945              132   3352.334975      0.000081\n1          DEN        2513974              132   3178.457197      0.000053\n```\n:::\n:::\n\n\nBased on the findings, the highest proportion of delayed flights was IAD (Washington Dulles) with the worst delays, even though its a smaller airport. Passengers that fly through IAD are more likely to experience delays. If we take into account the average delay duratio, ORD (Chicago O'Hare) would be the worst airport. Suggesting that even though delays are less likely and less frequent than IAD, they are significantly longer when they do happen. IAD is the worst in frequency and ORD is the worst in severity. \n\n## QUESTION|TASK 3\n\n__What is the best month to fly if you want to avoid delays of any length?__\n\nTo identify the best month to fly, I analyzed average delay per flight by month. I chose this metric because it accounts for both the frequency and intensity of delays, rather than just whether any delay occurred. By calculating the total minutes of delay divided by the total number of flights for each airport-month, then averaging these across all airports, we get a fair comparison of punctuality month by month.\n\n::: {#8a840291 .cell execution_count=5}\n``` {.python .cell-code}\n# Filter and clean the data\ndf_month = df_clean.copy()\n\n# Drop rows missing month or flights\ndf_month = df_month.dropna(subset=['month', 'num_of_flights_total'])\n\n# Map month names to numbers\nmonth_name_to_num = {\n    'January': 1, 'February': 2, 'March': 3, 'April': 4,\n    'May': 5, 'June': 6, 'July': 7, 'August': 8,\n    'September': 9, 'October': 10, 'November': 11, 'December': 12\n}\ndf_month['month_num'] = df_month['month'].map(month_name_to_num)\n\n# Fix missing delay values so months like February aren’t dropped\ndf_month['minutes_delayed_total'] = pd.to_numeric(df_month['minutes_delayed_total'], errors='coerce').fillna(0)\n\n# Drop if num_of_flights_total is 0\ndf_month = df_month[df_month['num_of_flights_total'] > 0]\n\n# Calculate average delay per flight\ndf_month['avg_delay_per_flight_hr'] = df_month['minutes_delayed_total'] / df_month['num_of_flights_total'] / 60\n\n# Group by month\nmonth_summary = (\n    df_month.groupby(['month', 'month_num'], as_index=False)\n    .agg(avg_delay_hr=('avg_delay_per_flight_hr', 'mean'))\n    .sort_values('month_num')\n)\n\n# Check which months are actually present\nprint(month_summary['month'])\n\n# Plot\nggplot(month_summary, aes(x='month', y='avg_delay_hr')) + \\\n    geom_bar(stat='identity', fill='#87CEEB') + \\\n    labs(title='Average Delay per Flight by Month (Hours)',\n         x='Month', y='Average Delay (Hours)') + \\\n    theme(axis_text_x=element_text(angle=45, hjust=1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n3       January\n6         March\n0         April\n7           May\n5          June\n4          July\n1        August\n10    September\n9       October\n8      November\n2      December\nName: month, dtype: object\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<html lang=\"en\">\n   <head>\n       <meta charset=\"UTF-8\">\n       <style> html, body { margin: 0; padding: 0; } </style>\n       <script type=\"text/javascript\" data-lets-plot-script=\"library\" src=\"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js\"></script>\n   </head>\n   <body>\n          <div id=\"YnyXOi\"></div>\n   <script type=\"text/javascript\" data-lets-plot-script=\"plot\">\n   \n   (function() {\n   // ----------\n   \n   const forceImmediateRender = false;\n   const responsive = false;\n   \n   let sizing = {\n       width_mode: \"MIN\",\n       height_mode: \"SCALED\",\n       width: null, \n       height: null \n   };\n   \n   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;\n   if (preferredWidth !== undefined) {\n       sizing = {\n           width_mode: 'FIXED',\n           height_mode: 'SCALED',\n           width: parseFloat(preferredWidth)\n       };\n   }\n   \n   const containerDiv = document.getElementById(\"YnyXOi\");\n   let fig = null;\n   \n   function renderPlot() {\n       if (fig === null) {\n           const plotSpec = {\n\"data\":{\n\"month\":[\"January\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\n\"avg_delay_hr\":[0.21373913639315123,0.1905262521173204,0.1673017573124624,0.17506239539548288,0.24854244539787493,0.23333970353292693,0.1976432954670572,0.14434587826699888,0.1558056300595373,0.14766058500821577,0.2585653757271397]\n},\n\"mapping\":{\n\"x\":\"month\",\n\"y\":\"avg_delay_hr\"\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"type\":\"str\",\n\"column\":\"month\"\n},{\n\"type\":\"float\",\n\"column\":\"month_num\"\n},{\n\"type\":\"float\",\n\"column\":\"avg_delay_hr\"\n}]\n},\n\"ggtitle\":{\n\"text\":\"Average Delay per Flight by Month (Hours)\"\n},\n\"guides\":{\n\"x\":{\n\"title\":\"Month\"\n},\n\"y\":{\n\"title\":\"Average Delay (Hours)\"\n}\n},\n\"theme\":{\n\"axis_text_x\":{\n\"angle\":45.0,\n\"hjust\":1.0,\n\"blank\":false\n}\n},\n\"kind\":\"plot\",\n\"scales\":[],\n\"layers\":[{\n\"geom\":\"bar\",\n\"stat\":\"identity\",\n\"mapping\":{\n},\n\"data_meta\":{\n},\n\"fill\":\"#87CEEB\",\n\"data\":{\n}\n}],\n\"metainfo_list\":[],\n\"spec_id\":\"1\"\n};\n           fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing);\n       } else {\n           fig.updateView({});\n       }\n   }\n   \n   const renderImmediately = \n       forceImmediateRender || (\n           sizing.width_mode === 'FIXED' && \n           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')\n       );\n   \n   if (renderImmediately) {\n       renderPlot();\n   }\n   \n   if (!renderImmediately || responsive) {\n       // Set up observer for initial sizing or continuous monitoring\n       var observer = new ResizeObserver(function(entries) {\n           for (let entry of entries) {\n               if (entry.contentBoxSize && \n                   entry.contentBoxSize[0].inlineSize > 0) {\n                   if (!responsive && observer) {\n                       observer.disconnect();\n                       observer = null;\n                   }\n                   renderPlot();\n                   if (!responsive) {\n                       break;\n                   }\n               }\n           }\n       });\n       \n       observer.observe(containerDiv);\n   }\n   \n   // ----------\n   })();\n   \n   </script>\n   </body>\n</html>\n```\n:::\n:::\n\n\n::: {#3a90ece0 .cell execution_count=6}\n``` {.python .cell-code}\nprint(df_clean[df_clean['month'] == 'February'])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nEmpty DataFrame\nColumns: [airport_code, airport_name, month, year, num_of_flights_total, num_of_delays_carrier, num_of_delays_late_aircraft, num_of_delays_nas, num_of_delays_security, num_of_delays_weather, num_of_delays_total, minutes_delayed_carrier, minutes_delayed_late_aircraft, minutes_delayed_nas, minutes_delayed_security, minutes_delayed_weather, minutes_delayed_total, is_delayed, delay_minutes_filled]\nIndex: []\n```\n:::\n:::\n\n\nThe chart displays the average delay per flight by month. Based on the data, September has the lowest average delays, making it the best month to travel if your goal is to avoid flight delays.\n\nThis metric reflects both the frequency and intensity of delays by dividing total delay minutes by total flights per month.\n\nNote: February does not appear in the dataset, likely due to missing or incomplete data for that month.\n\n## QUESTION|TASK 4\n\nAccording to the BTS website, the “Weather” category only accounts for severe weather delays. Mild weather delays are not counted in the “Weather” category, but are actually included in both the “NAS” and “Late-Arriving Aircraft” categories.\n\nThis section combines delays from three sources: 100% of flights delayed due to severe weather, 30% of delays from late-arriving aircraft, and a month-based proportion of NAS delays (40% from April to August, 65% otherwise). This provides a more complete picture of how both severe and mild weather conditions contribute to flight delays. The data shows that ORD (Chicago O’Hare) experiences the highest total number of weather-related delays (4,502 flights), suggesting it is especially vulnerable to both direct and indirect weather impacts. ATL (Atlanta) also has a substantial number of delays (~3,769), driven largely by NAS-related disruptions. In contrast, airports like IAD (Washington Dulles) and SAN (San Diego) show lower weather-related delay totals, indicating they are either less exposed to disruptive weather or more resilient in handling its effects. This approach offers a more realistic view of weather’s full influence on airport performance.\n\n::: {#5145b9c8 .cell execution_count=7}\n``` {.python .cell-code}\n# Fill missing values for the relevant columns\ndf_clean['num_of_delays_late_aircraft'] = pd.to_numeric(df_clean['num_of_delays_late_aircraft'], errors='coerce')\ndf_clean['num_of_delays_weather'] = pd.to_numeric(df_clean['num_of_delays_weather'], errors='coerce').fillna(0)\ndf_clean['num_of_delays_nas'] = pd.to_numeric(df_clean['num_of_delays_nas'], errors='coerce').fillna(0)\n\n# Replace negative or invalid late_aircraft values with NaN first\ndf_clean.loc[df_clean['num_of_delays_late_aircraft'] < 0, 'num_of_delays_late_aircraft'] = np.nan\n\n# Fill missing late_aircraft with mean\nlate_mean = df_clean['num_of_delays_late_aircraft'].mean()\ndf_clean['num_of_delays_late_aircraft'] = df_clean['num_of_delays_late_aircraft'].fillna(late_mean)\n```\n:::\n\n\n::: {#0baaa4c0 .cell execution_count=8}\n``` {.python .cell-code}\n# Map month names to numbers\nmonth_to_num = {\n    'January': 1, 'February': 2, 'March': 3, 'April': 4,\n    'May': 5, 'June': 6, 'July': 7, 'August': 8,\n    'September': 9, 'October': 10, 'November': 11, 'December': 12\n}\ndf_clean['month_num'] = df_clean['month'].map(month_to_num)\n\n# Define the NAS weather delay proportion rule\ndef nas_weather_proportion(month_num):\n    if pd.isna(month_num):\n        return 0\n    return 0.4 if 4 <= month_num <= 8 else 0.65\n```\n:::\n\n\n::: {#a3ae5f9e .cell execution_count=9}\n``` {.python .cell-code}\n# Calculate combined weather delay using all rules\ndf_clean['weather_delay_all'] = (\n    df_clean['num_of_delays_weather'] +\n    0.3 * df_clean['num_of_delays_late_aircraft'] +\n    df_clean['num_of_delays_nas'] * df_clean['month_num'].apply(nas_weather_proportion)\n)\n\n# Display first 5 rows of relevant columns\ndf_clean[['airport_code', 'month', 'num_of_delays_weather',\n          'num_of_delays_late_aircraft', 'num_of_delays_nas',\n          'weather_delay_all']].rename(columns={\n    'airport_code': 'airport',\n    'num_of_delays_weather': 'delays_weather',\n    'num_of_delays_late_aircraft': 'late_aircraft',\n    'num_of_delays_nas': 'delays_nas'\n}).head()\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>airport</th>\n      <th>month</th>\n      <th>delays_weather</th>\n      <th>late_aircraft</th>\n      <th>delays_nas</th>\n      <th>weather_delay_all</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ATL</td>\n      <td>January</td>\n      <td>448</td>\n      <td>1109.228766</td>\n      <td>4598</td>\n      <td>3769.46863</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>DEN</td>\n      <td>January</td>\n      <td>233</td>\n      <td>928.000000</td>\n      <td>935</td>\n      <td>1119.15000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>IAD</td>\n      <td>January</td>\n      <td>61</td>\n      <td>1058.000000</td>\n      <td>895</td>\n      <td>960.15000</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>ORD</td>\n      <td>January</td>\n      <td>306</td>\n      <td>2255.000000</td>\n      <td>5415</td>\n      <td>4502.25000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>SAN</td>\n      <td>January</td>\n      <td>56</td>\n      <td>680.000000</td>\n      <td>638</td>\n      <td>674.70000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## QUESTION|TASK 5\n\n__Using the new weather variable calculated above, create a barplot showing the proportion of all flights that are delayed by weather at each airport. Describe what you learn from this graph.__  \n\nThis chart shows the proportion of total flights at each airport that were delayed by weather, accounting for both severe and mild delays. Airports like SFO and ORD show the highest proportions of weather-related delays. In contrast, airports such as SLC and SAN have relatively fewer weather-related delays, suggesting more stable flying conditions.\n\n::: {#82812a81 .cell execution_count=10}\n``` {.python .cell-code}\n# Fix potential missing data\ndf_clean['weather_delay_all'] = df_clean['weather_delay_all'].fillna(0)\ndf_clean['num_of_flights_total'] = df_clean['num_of_flights_total'].fillna(0)\n\n# Summarize again\nweather_summary = (\n    df_clean.groupby('airport_code')\n    .agg(\n        total_flights=('num_of_flights_total', 'sum'),\n        total_weather_delays=('weather_delay_all', 'sum')\n    )\n    .assign(prop_weather_delay=lambda d: d['total_weather_delays'] / d['total_flights'])\n    .query('total_flights > 0')\n    .reset_index()\n)\n\n# Sort for plotting\nweather_summary_sorted = weather_summary.sort_values('prop_weather_delay', ascending=False)\n\n# Plot\nggplot(weather_summary_sorted, aes(x='airport_code', y='prop_weather_delay')) + \\\n    geom_bar(stat='identity', fill='#FF7F7F') + \\\n    labs(title='Proportion of Total Flights Delayed by Weather',\n         x='Airport', y='Proportion of Flights') + \\\n    theme(axis_text_x=element_text(size=10, angle=45, hjust=1))\n\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<html lang=\"en\">\n   <head>\n       <meta charset=\"UTF-8\">\n       <style> html, body { margin: 0; padding: 0; } </style>\n       <script type=\"text/javascript\" data-lets-plot-script=\"library\" src=\"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js\"></script>\n   </head>\n   <body>\n          <div id=\"G0Khkj\"></div>\n   <script type=\"text/javascript\" data-lets-plot-script=\"plot\">\n   \n   (function() {\n   // ----------\n   \n   const forceImmediateRender = false;\n   const responsive = false;\n   \n   let sizing = {\n       width_mode: \"MIN\",\n       height_mode: \"SCALED\",\n       width: null, \n       height: null \n   };\n   \n   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;\n   if (preferredWidth !== undefined) {\n       sizing = {\n           width_mode: 'FIXED',\n           height_mode: 'SCALED',\n           width: parseFloat(preferredWidth)\n       };\n   }\n   \n   const containerDiv = document.getElementById(\"G0Khkj\");\n   let fig = null;\n   \n   function renderPlot() {\n       if (fig === null) {\n           const plotSpec = {\n\"data\":{\n\"airport_code\":[\"SFO\",\"ORD\",\"ATL\",\"IAD\",\"DEN\",\"SAN\",\"SLC\"],\n\"prop_weather_delay\":[0.0888978283324524,0.07895814487892619,0.06471770404877795,0.05653075316092258,0.05479404321603962,0.04922570059551436,0.03976865918380144]\n},\n\"mapping\":{\n\"x\":\"airport_code\",\n\"y\":\"prop_weather_delay\"\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"type\":\"str\",\n\"column\":\"airport_code\"\n},{\n\"type\":\"int\",\n\"column\":\"total_flights\"\n},{\n\"type\":\"float\",\n\"column\":\"total_weather_delays\"\n},{\n\"type\":\"float\",\n\"column\":\"prop_weather_delay\"\n}]\n},\n\"ggtitle\":{\n\"text\":\"Proportion of Total Flights Delayed by Weather\"\n},\n\"guides\":{\n\"x\":{\n\"title\":\"Airport\"\n},\n\"y\":{\n\"title\":\"Proportion of Flights\"\n}\n},\n\"theme\":{\n\"axis_text_x\":{\n\"size\":10.0,\n\"angle\":45.0,\n\"hjust\":1.0,\n\"blank\":false\n}\n},\n\"kind\":\"plot\",\n\"scales\":[],\n\"layers\":[{\n\"geom\":\"bar\",\n\"stat\":\"identity\",\n\"mapping\":{\n},\n\"data_meta\":{\n},\n\"fill\":\"#FF7F7F\",\n\"data\":{\n}\n}],\n\"metainfo_list\":[],\n\"spec_id\":\"2\"\n};\n           fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing);\n       } else {\n           fig.updateView({});\n       }\n   }\n   \n   const renderImmediately = \n       forceImmediateRender || (\n           sizing.width_mode === 'FIXED' && \n           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')\n       );\n   \n   if (renderImmediately) {\n       renderPlot();\n   }\n   \n   if (!renderImmediately || responsive) {\n       // Set up observer for initial sizing or continuous monitoring\n       var observer = new ResizeObserver(function(entries) {\n           for (let entry of entries) {\n               if (entry.contentBoxSize && \n                   entry.contentBoxSize[0].inlineSize > 0) {\n                   if (!responsive && observer) {\n                       observer.disconnect();\n                       observer = null;\n                   }\n                   renderPlot();\n                   if (!responsive) {\n                       break;\n                   }\n               }\n           }\n       });\n       \n       observer.observe(containerDiv);\n   }\n   \n   // ----------\n   })();\n   \n   </script>\n   </body>\n</html>\n```\n:::\n:::\n\n\n---\n\n\n## STRETCH QUESTION|TASK 1\n\n__Which delay is the worst delay?__\n\nThe analysis shows that weather-related delays are the most significant, affecting approximately 6.5% of all flights. These delays include both severe and mild weather impacts, offering a more comprehensive view of real-world disruptions. Carrier delays, which typically stem from airline operational issues, are also notable at 3.8%. In contrast, security delays are extremely rare, impacting less than 0.1% of total flights. This comparison highlights that weather is the dominant factor in flight disruptions, both in terms of frequency and impact.\n\n::: {#63a738fb .cell execution_count=11}\n``` {.python .cell-code}\n## STRETCH QUESTION|TASK 1\ncarrier = pd.to_numeric(df_clean['num_of_delays_carrier'], errors='coerce').fillna(0).sum()\nsecurity = pd.to_numeric(df_clean['num_of_delays_security'], errors='coerce').fillna(0).sum()\nweather = pd.to_numeric(df_clean['weather_delay_all'], errors='coerce').fillna(0).sum()\n\n# Total flights\ntotal_flights = pd.to_numeric(df_clean['num_of_flights_total'], errors='coerce').fillna(0).sum()\n\n# Build the DataFrame\ntotals = pd.DataFrame({\n    'delay_type': ['Carrier', 'Security', 'Weather'],\n    'total_delays': [carrier, security, weather]\n})\n\n# Ensure all are numeric\ntotals['total_delays'] = pd.to_numeric(totals['total_delays'], errors='coerce')\n\n# Calculate proportions\ntotals['prop_delayed'] = totals['total_delays'] / total_flights\n\n# Sort\ntotals = totals.sort_values('prop_delayed', ascending=False)\n\n# Print safely\nprint(totals.to_string(index=False))\n\n\n# Optional plot\nggplot(totals, aes(x='delay_type', y='prop_delayed')) + \\\n    geom_bar(stat='identity', fill='#FF7F7F') + \\\n    labs(title='Proportion of Total Flights Delayed by Category',\n         x='Delay Type', y='Proportion of Flights') + \\\n    theme(axis_text_x=element_text(size=12))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ndelay_type  total_delays  prop_delayed\n   Weather  1.002633e+06      0.065338\n   Carrier  5.882920e+05      0.038337\n  Security  5.006000e+03      0.000326\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<html lang=\"en\">\n   <head>\n       <meta charset=\"UTF-8\">\n       <style> html, body { margin: 0; padding: 0; } </style>\n       <script type=\"text/javascript\" data-lets-plot-script=\"library\" src=\"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js\"></script>\n   </head>\n   <body>\n          <div id=\"QTiolw\"></div>\n   <script type=\"text/javascript\" data-lets-plot-script=\"plot\">\n   \n   (function() {\n   // ----------\n   \n   const forceImmediateRender = false;\n   const responsive = false;\n   \n   let sizing = {\n       width_mode: \"MIN\",\n       height_mode: \"SCALED\",\n       width: null, \n       height: null \n   };\n   \n   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;\n   if (preferredWidth !== undefined) {\n       sizing = {\n           width_mode: 'FIXED',\n           height_mode: 'SCALED',\n           width: parseFloat(preferredWidth)\n       };\n   }\n   \n   const containerDiv = document.getElementById(\"QTiolw\");\n   let fig = null;\n   \n   function renderPlot() {\n       if (fig === null) {\n           const plotSpec = {\n\"data\":{\n\"delay_type\":[\"Weather\",\"Carrier\",\"Security\"],\n\"prop_delayed\":[0.06533779234249433,0.03833677269842482,3.262221552023734E-4]\n},\n\"mapping\":{\n\"x\":\"delay_type\",\n\"y\":\"prop_delayed\"\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"type\":\"str\",\n\"column\":\"delay_type\"\n},{\n\"type\":\"float\",\n\"column\":\"total_delays\"\n},{\n\"type\":\"float\",\n\"column\":\"prop_delayed\"\n}]\n},\n\"ggtitle\":{\n\"text\":\"Proportion of Total Flights Delayed by Category\"\n},\n\"guides\":{\n\"x\":{\n\"title\":\"Delay Type\"\n},\n\"y\":{\n\"title\":\"Proportion of Flights\"\n}\n},\n\"theme\":{\n\"axis_text_x\":{\n\"size\":12.0,\n\"blank\":false\n}\n},\n\"kind\":\"plot\",\n\"scales\":[],\n\"layers\":[{\n\"geom\":\"bar\",\n\"stat\":\"identity\",\n\"mapping\":{\n},\n\"data_meta\":{\n},\n\"fill\":\"#FF7F7F\",\n\"data\":{\n}\n}],\n\"metainfo_list\":[],\n\"spec_id\":\"3\"\n};\n           fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing);\n       } else {\n           fig.updateView({});\n       }\n   }\n   \n   const renderImmediately = \n       forceImmediateRender || (\n           sizing.width_mode === 'FIXED' && \n           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')\n       );\n   \n   if (renderImmediately) {\n       renderPlot();\n   }\n   \n   if (!renderImmediately || responsive) {\n       // Set up observer for initial sizing or continuous monitoring\n       var observer = new ResizeObserver(function(entries) {\n           for (let entry of entries) {\n               if (entry.contentBoxSize && \n                   entry.contentBoxSize[0].inlineSize > 0) {\n                   if (!responsive && observer) {\n                       observer.disconnect();\n                       observer = null;\n                   }\n                   renderPlot();\n                   if (!responsive) {\n                       break;\n                   }\n               }\n           }\n       });\n       \n       observer.observe(containerDiv);\n   }\n   \n   // ----------\n   })();\n   \n   </script>\n   </body>\n</html>\n```\n:::\n:::\n\n\nThe bar chart clearly visualizes:\nWeather delays are the most common, affecting ~6.5% of all flights\nCarrier delays are next, affecting ~3.8%\nSecurity delays are extremely rare, under 0.1%\n\n---\n\n",
    "supporting": [
      "project3_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}