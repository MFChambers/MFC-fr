{"title":"Client Report - Finding Relationships in Baseball","markdown":{"yaml":{"title":"Client Report - Finding Relationships in Baseball","subtitle":"Course DS 250","author":"[Maia Faith Chambers]","format":{"html":{"self-contained":true,"page-layout":"full","title-block-banner":true,"toc":true,"toc-depth":3,"toc-location":"body","number-sections":false,"html-math-method":"katex","code-fold":true,"code-summary":"Show the code","code-overflow":"wrap","code-copy":"hover","code-tools":{"source":false,"toggle":true,"caption":"See code"}}},"execute":{"warning":false}},"headingText":"Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html","containsRefs":false,"markdown":"\n\n```{python}\nimport pandas as pd \nimport numpy as np\nimport sqlite3\nfrom lets_plot import *\n\nLetsPlot.setup_html(isolated_frame=True)\nsqlite_file = 'lahmansbaseballdb.sqlite'\ncon = sqlite3.connect(sqlite_file)\n```\n\n\n```{python}\n\n\n```\n\n## QUESTION|TASK 1\n\n__Write an SQL query to create a new dataframe about baseball players who attended BYU-Idaho. The new table should contain five columns: playerID, schoolID, salary, and the yearID/teamID associated with each salary. Order the table by salary (highest to lowest) and print out the table in your report.__  \n\nThe query below returns the results of two players who attended BYU-Idaho: Mark L. Lindsma and Garrett Stephenson, identified by their player IDs as lindsma01 and stephga01, respectively. Both players had long and varied careers in Major League Baseball. Lindsma played from 2007 to 2014, while Stephenson’s career spanned from 1997 to 2003. Lindsma’s salary peaked later in his career, earning $4,000,000 in 2014 with the Chicago White Sox. In contrast, Stephenson reached his highest salary of $1,025,000 in 2001, during the mid-point of his career with the St. Louis Cardinals. This analysis highlights the financial success of these two BYU-Idaho alumni in the professional baseball world.\n\n```{python}\n# Query salary info for BYU-Idaho players using known playerIDs\nquery_byu_players = \"\"\"\nSELECT \n    playerID, \n    salary,\n    yearID,\n    teamID\nFROM \n    Salaries\nWHERE \n    playerID IN ('lindsma01', 'stephga01')\nORDER BY \n    salary DESC;\n\"\"\"\ndf_baseball1 = pd.read_sql_query(query_byu_players, con)\ndf_baseball1[\"schoolID\"] = \"idbyuid\"\ndf_baseball1\n\n```\n\n```{python}\n#This part is extra, I wanted to see how it would look in a lets plot showing the comparrison of salary over the two players careers.\n# Line plot to visualize their salary over time\nquery_compare_salaries = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    salary\nFROM \n    Salaries\nWHERE \n    playerID IN ('lindsma01', 'stephga01')\nORDER BY \n    yearID;\n\"\"\"\n\ndf_salaries = pd.read_sql_query(query_compare_salaries, con)\n\nplayer_colors = {\n    'lindsma01': '#27251F',\n    'stephga01': '#C41E3A'\n}\n\nggplot(df_salaries, aes(x='yearID', y='salary', color=as_discrete('playerID'))) + \\\n    geom_line(size=2) + \\\n    scale_color_manual(values=player_colors) + \\\n    scale_x_continuous(breaks=list(range(df_salaries['yearID'].min(), df_salaries['yearID'].max()+1))) + \\\n    ggtitle(\"Salary Comparison: Mark Lindsma vs Garrett Stephenson\") + \\\n    xlab(\"Year\") + \\\n    ylab(\"Salary (USD)\") + \\\n    theme_minimal()\n\n\n```\n\n\n## QUESTION|TASK 2\n\n__This three-part question requires you to calculate batting average (number of hits divided by the number of at-bats)__  \n    a. Write an SQL query that provides playerID, yearID, and batting average for players with at least 1 at bat that year. Sort the table from highest batting average to lowest, and then by playerid alphabetically. Show the top 5 results in your report.  \n    a. Use the same query as above, but only include players with at least 10 at bats that year. Print the top 5 results.  \n    a. Now calculate the batting average for players over their entire careers (all years combined). Only include players with at least 100 at bats, and print the top 5 results.  \n\nThis three-part question looked at batting averages, which are calculated by dividing hits by at-bats. For the first part, I found the top batting averages for players who had at least one at-bat in a season. Not surprisingly, all five players had a perfect 1.000 average, meaning they got a hit every time they were officially at bat that year. But most of them probably only had one or two chances, so the data isn't super meaningful yet.\n\n```{python}\n# Include and execute your code here\nquery_2a = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    ROUND(CAST(H AS FLOAT)/AB, 3) AS batting_avg\nFROM \n    Batting\nWHERE \n    AB > 0\nORDER BY \n    batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2a = pd.read_sql_query(query_2a, con)\ndf_2a\n\n```\n\nIn the second part, I made the filter a bit stricter by only including players with at least 10 at-bats. This helped bring out more reliable results. The top players now had averages between .571 and .643, with names like Manny Ny (1974) and Carson M. (2013) leading the list. These guys still had great seasons, but the extra filter helps avoid flukes.\n```{python}\nquery_2b = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    ROUND(CAST(H AS FLOAT)/AB, 3) AS batting_avg\nFROM \n    Batting\nWHERE \n    AB >= 10\nORDER BY \n    batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2b = pd.read_sql_query(query_2b, con)\ndf_2b\n\n```\n\nFor the third part, I calculated batting averages over entire careers by summing up all hits and at-bats for each player and then dividing. I also made sure to only include players with at least 100 at-bats total. The results brought out legends like Ty Cobb (.366), Rogers Hornsby (.358), and Joe Jackson (.356). These are the kind of averages that reflect long-term consistency, not just one standout season.\n```{python}\nquery_2c = \"\"\"\nSELECT \n    playerID, \n    ROUND(SUM(CAST(H AS FLOAT))/SUM(AB), 3) AS career_batting_avg\nFROM \n    Batting\nGROUP BY \n    playerID\nHAVING \n    SUM(AB) >= 100\nORDER BY \n    career_batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2c = pd.read_sql_query(query_2c, con)\ndf_2c\n\n\n```\n\n\n## QUESTION|TASK 3\n\n__Pick any two baseball teams and compare them using a metric of your choice (average salary, home runs, number of wins, etc). Write an SQL query to get the data you need, then make a graph using Lets-Plot to visualize the comparison. What do you learn?__\n\nI used the Seattle Mariners and the Texas rangers using average salary by year as my metric. The SQL query groups the player salaries by team and year and then calculates the average salary for each. The results are from the range years of 1985 to 2016, during this time the avaerage salary was over $6 million. The Marineres showed growth but were slightly behind in the end. This comparison gave me a better sense of how each organization has financially valued its players over time. It also raises questions about how payroll size might relate to team performance, although I'm a mariners fan, I realize we lost many games so it would be interesting to see a performance to salary analysis.\n\n```{python}\nquery_task3_mariners_rangers = \"\"\"\nSELECT \n    teamID, \n    yearID, \n    ROUND(AVG(salary), 2) AS avg_salary\nFROM \n    Salaries\nWHERE \n    teamID IN ('SEA', 'TEX')\nGROUP BY \n    teamID, yearID\nORDER BY \n    yearID;\n\"\"\"\n\ndf_task3_mr = pd.read_sql_query(query_task3_mariners_rangers, con)\ndf_task3_mr\n\n```\n\nThe chart shows that both teams started with lower salaries in the 1980s, but average pay steadily increased over time. While both teams experienced ups and downs, the Texas Rangers had more dramatic spikes and sharper increases compared to the Mariners. The Mariners' salary growth was more consistent and gradual, whereas the Rangers ended up on top with more noticeable jumps throughout the years.\n```{python}\n#the plot\nfrom lets_plot.mapping import as_discrete\n\nteam_colors = {\n    'SEA': '#0C2C56',  # Mariners - Navy\n    'TEX': '#C0111F'   # Rangers - Red\n}\n\nggplot(df_task3_mr, aes(x='yearID', y='avg_salary', color=as_discrete('teamID'))) + \\\n    geom_line(size=1.5) + \\\n    scale_color_manual(values=team_colors) + \\\n    scale_x_continuous(breaks=list(range(df_task3_mr['yearID'].min(), df_task3_mr['yearID'].max()+1))) + \\\n    ggtitle(\"Average Salary: Seattle Mariners vs Texas Rangers\") + \\\n    xlab(\"Year\") + \\\n    ylab(\"Average Salary (USD)\") + \\\n    theme_minimal()\n\n```\n\n---\n\n## STRETCH QUESTION|TASK 1\n\n__Advanced Salary Distribution by Position (with Case Statement):__  \n\n    * Write an SQL query that provides a summary table showing the average salary for each position (e.g., pitcher, catcher, outfielder). Position information can be found in the fielding table in the POS column. \n    \n        Include the following columns:\n\n        * position\n        * average_salary\n        * total_players\n        * highest_salary  \n\n    * The highest_salary column should display the highest salary ever earned by a player in that position. \n\n    * Additionally, create a new column called salary_category using a case statement:  \n\n        * If the average salary is above $3 million, categorize it as “High Salary.”\n        * If the average salary is between $2 million and $3 million, categorize it as “Medium Salary.”\n        * Otherwise, categorize it as “Low Salary.”  \n\n    * Order the table by average salary in descending order.\n\n    **Hint:** Beware, it is common for a player to play multiple positions in a single year. For this analysis, each player’s salary should only be counted toward one position in a given year: the position at which they played the most games that year. This will likely require a (sub-query)[https://docs.data.world/documentation/sql/concepts/advanced/WITH.html].\n\n    \n\n_type your results and analysis here_\n\n```{python}\n# Include and execute your code here\nsalary_by_position_query = \"\"\"\nWITH PrimaryPosition AS (\n    SELECT \n        playerID,\n        yearID,\n        POS,\n        MAX(G) AS games_played\n    FROM (\n        SELECT \n            playerID, \n            yearID, \n            POS, \n            SUM(G) AS G\n        FROM \n            Fielding\n        GROUP BY \n            playerID, yearID, POS\n    )\n    GROUP BY \n        playerID, yearID\n    HAVING \n        G = MAX(G)\n),\n\nPositionSalary AS (\n    SELECT \n        pp.POS AS position,\n        s.playerID,\n        s.salary\n    FROM \n        Salaries s\n    JOIN \n        PrimaryPosition pp ON s.playerID = pp.playerID AND s.yearID = pp.yearID\n)\n\nSELECT \n    position,\n    ROUND(AVG(salary), 2) AS average_salary,\n    COUNT(DISTINCT playerID) AS total_players,\n    MAX(salary) AS highest_salary,\n    CASE \n        WHEN AVG(salary) > 3000000 THEN 'High Salary'\n        WHEN AVG(salary) BETWEEN 2000000 AND 3000000 THEN 'Medium Salary'\n        ELSE 'Low Salary'\n    END AS salary_category\nFROM \n    PositionSalary\nGROUP BY \n    position\nORDER BY \n    average_salary DESC;\n\"\"\"\n\ndf_salary_by_position = pd.read_sql_query(salary_by_position_query, con)\ndf_salary_by_position\n\n\n```\n\n\n## STRETCH QUESTION|TASK 2\n\n__Advanced Career Longevity and Performance (with Subqueries):__\n\n    * Calculate the average career length (in years) for players who have played at least **10 games**. Then, identify the top 10 players with the longest careers (based on the number of years they played). Include their: \n\n        * playerID\n        * first_name\n        * last_name\n        * career_length\n\n    * The career_length should be calculated as the difference between the maximum and minimum yearID for each player.  \n\n_type your results and analysis here_\n\n```{python}\ncareer_query = \"\"\"\nWITH CareerSpan AS (\n    SELECT \n        a.playerID,\n        MIN(a.yearID) AS start_year,\n        MAX(a.yearID) AS end_year,\n        (MAX(a.yearID) - MIN(a.yearID) + 1) AS career_length,\n        SUM(a.G_all) AS total_games\n    FROM \n        Appearances a\n    GROUP BY \n        a.playerID\n    HAVING \n        total_games >= 10\n),\n\nTopCareers AS (\n    SELECT \n        cs.playerID,\n        p.nameFirst AS first_name,\n        p.nameLast AS last_name,\n        cs.career_length\n    FROM \n        CareerSpan cs\n    JOIN \n        People p ON cs.playerID = p.playerID\n    ORDER BY \n        cs.career_length DESC\n    LIMIT 10\n)\n\nSELECT \n    * \nFROM \n    TopCareers;\n\"\"\"\n\ndf_top_careers = pd.read_sql_query(career_query, con)\ndf_top_careers\n\n\n```\n\n```{python}\navg_career_query = \"\"\"\nWITH CareerSpan AS (\n    SELECT \n        playerID,\n        MIN(yearID) AS start_year,\n        MAX(yearID) AS end_year,\n        (MAX(yearID) - MIN(yearID) + 1) AS career_length,\n        SUM(G_all) AS total_games\n    FROM \n        Appearances\n    GROUP BY \n        playerID\n    HAVING \n        total_games >= 10\n)\n\nSELECT \n    ROUND(AVG(career_length), 2) AS avg_career_length\nFROM \n    CareerSpan;\n\"\"\"\n\ndf_avg_career = pd.read_sql_query(avg_career_query, con)\ndf_avg_career\n```\n---\n\n","srcMarkdownNoYaml":"\n\n```{python}\nimport pandas as pd \nimport numpy as np\nimport sqlite3\nfrom lets_plot import *\n\nLetsPlot.setup_html(isolated_frame=True)\nsqlite_file = 'lahmansbaseballdb.sqlite'\ncon = sqlite3.connect(sqlite_file)\n```\n\n\n```{python}\n# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html\n\n\n```\n\n## QUESTION|TASK 1\n\n__Write an SQL query to create a new dataframe about baseball players who attended BYU-Idaho. The new table should contain five columns: playerID, schoolID, salary, and the yearID/teamID associated with each salary. Order the table by salary (highest to lowest) and print out the table in your report.__  \n\nThe query below returns the results of two players who attended BYU-Idaho: Mark L. Lindsma and Garrett Stephenson, identified by their player IDs as lindsma01 and stephga01, respectively. Both players had long and varied careers in Major League Baseball. Lindsma played from 2007 to 2014, while Stephenson’s career spanned from 1997 to 2003. Lindsma’s salary peaked later in his career, earning $4,000,000 in 2014 with the Chicago White Sox. In contrast, Stephenson reached his highest salary of $1,025,000 in 2001, during the mid-point of his career with the St. Louis Cardinals. This analysis highlights the financial success of these two BYU-Idaho alumni in the professional baseball world.\n\n```{python}\n# Query salary info for BYU-Idaho players using known playerIDs\nquery_byu_players = \"\"\"\nSELECT \n    playerID, \n    salary,\n    yearID,\n    teamID\nFROM \n    Salaries\nWHERE \n    playerID IN ('lindsma01', 'stephga01')\nORDER BY \n    salary DESC;\n\"\"\"\ndf_baseball1 = pd.read_sql_query(query_byu_players, con)\ndf_baseball1[\"schoolID\"] = \"idbyuid\"\ndf_baseball1\n\n```\n\n```{python}\n#This part is extra, I wanted to see how it would look in a lets plot showing the comparrison of salary over the two players careers.\n# Line plot to visualize their salary over time\nquery_compare_salaries = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    salary\nFROM \n    Salaries\nWHERE \n    playerID IN ('lindsma01', 'stephga01')\nORDER BY \n    yearID;\n\"\"\"\n\ndf_salaries = pd.read_sql_query(query_compare_salaries, con)\n\nplayer_colors = {\n    'lindsma01': '#27251F',\n    'stephga01': '#C41E3A'\n}\n\nggplot(df_salaries, aes(x='yearID', y='salary', color=as_discrete('playerID'))) + \\\n    geom_line(size=2) + \\\n    scale_color_manual(values=player_colors) + \\\n    scale_x_continuous(breaks=list(range(df_salaries['yearID'].min(), df_salaries['yearID'].max()+1))) + \\\n    ggtitle(\"Salary Comparison: Mark Lindsma vs Garrett Stephenson\") + \\\n    xlab(\"Year\") + \\\n    ylab(\"Salary (USD)\") + \\\n    theme_minimal()\n\n\n```\n\n\n## QUESTION|TASK 2\n\n__This three-part question requires you to calculate batting average (number of hits divided by the number of at-bats)__  \n    a. Write an SQL query that provides playerID, yearID, and batting average for players with at least 1 at bat that year. Sort the table from highest batting average to lowest, and then by playerid alphabetically. Show the top 5 results in your report.  \n    a. Use the same query as above, but only include players with at least 10 at bats that year. Print the top 5 results.  \n    a. Now calculate the batting average for players over their entire careers (all years combined). Only include players with at least 100 at bats, and print the top 5 results.  \n\nThis three-part question looked at batting averages, which are calculated by dividing hits by at-bats. For the first part, I found the top batting averages for players who had at least one at-bat in a season. Not surprisingly, all five players had a perfect 1.000 average, meaning they got a hit every time they were officially at bat that year. But most of them probably only had one or two chances, so the data isn't super meaningful yet.\n\n```{python}\n# Include and execute your code here\nquery_2a = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    ROUND(CAST(H AS FLOAT)/AB, 3) AS batting_avg\nFROM \n    Batting\nWHERE \n    AB > 0\nORDER BY \n    batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2a = pd.read_sql_query(query_2a, con)\ndf_2a\n\n```\n\nIn the second part, I made the filter a bit stricter by only including players with at least 10 at-bats. This helped bring out more reliable results. The top players now had averages between .571 and .643, with names like Manny Ny (1974) and Carson M. (2013) leading the list. These guys still had great seasons, but the extra filter helps avoid flukes.\n```{python}\nquery_2b = \"\"\"\nSELECT \n    playerID, \n    yearID, \n    ROUND(CAST(H AS FLOAT)/AB, 3) AS batting_avg\nFROM \n    Batting\nWHERE \n    AB >= 10\nORDER BY \n    batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2b = pd.read_sql_query(query_2b, con)\ndf_2b\n\n```\n\nFor the third part, I calculated batting averages over entire careers by summing up all hits and at-bats for each player and then dividing. I also made sure to only include players with at least 100 at-bats total. The results brought out legends like Ty Cobb (.366), Rogers Hornsby (.358), and Joe Jackson (.356). These are the kind of averages that reflect long-term consistency, not just one standout season.\n```{python}\nquery_2c = \"\"\"\nSELECT \n    playerID, \n    ROUND(SUM(CAST(H AS FLOAT))/SUM(AB), 3) AS career_batting_avg\nFROM \n    Batting\nGROUP BY \n    playerID\nHAVING \n    SUM(AB) >= 100\nORDER BY \n    career_batting_avg DESC, playerID ASC\nLIMIT 5;\n\"\"\"\n\ndf_2c = pd.read_sql_query(query_2c, con)\ndf_2c\n\n\n```\n\n\n## QUESTION|TASK 3\n\n__Pick any two baseball teams and compare them using a metric of your choice (average salary, home runs, number of wins, etc). Write an SQL query to get the data you need, then make a graph using Lets-Plot to visualize the comparison. What do you learn?__\n\nI used the Seattle Mariners and the Texas rangers using average salary by year as my metric. The SQL query groups the player salaries by team and year and then calculates the average salary for each. The results are from the range years of 1985 to 2016, during this time the avaerage salary was over $6 million. The Marineres showed growth but were slightly behind in the end. This comparison gave me a better sense of how each organization has financially valued its players over time. It also raises questions about how payroll size might relate to team performance, although I'm a mariners fan, I realize we lost many games so it would be interesting to see a performance to salary analysis.\n\n```{python}\nquery_task3_mariners_rangers = \"\"\"\nSELECT \n    teamID, \n    yearID, \n    ROUND(AVG(salary), 2) AS avg_salary\nFROM \n    Salaries\nWHERE \n    teamID IN ('SEA', 'TEX')\nGROUP BY \n    teamID, yearID\nORDER BY \n    yearID;\n\"\"\"\n\ndf_task3_mr = pd.read_sql_query(query_task3_mariners_rangers, con)\ndf_task3_mr\n\n```\n\nThe chart shows that both teams started with lower salaries in the 1980s, but average pay steadily increased over time. While both teams experienced ups and downs, the Texas Rangers had more dramatic spikes and sharper increases compared to the Mariners. The Mariners' salary growth was more consistent and gradual, whereas the Rangers ended up on top with more noticeable jumps throughout the years.\n```{python}\n#the plot\nfrom lets_plot.mapping import as_discrete\n\nteam_colors = {\n    'SEA': '#0C2C56',  # Mariners - Navy\n    'TEX': '#C0111F'   # Rangers - Red\n}\n\nggplot(df_task3_mr, aes(x='yearID', y='avg_salary', color=as_discrete('teamID'))) + \\\n    geom_line(size=1.5) + \\\n    scale_color_manual(values=team_colors) + \\\n    scale_x_continuous(breaks=list(range(df_task3_mr['yearID'].min(), df_task3_mr['yearID'].max()+1))) + \\\n    ggtitle(\"Average Salary: Seattle Mariners vs Texas Rangers\") + \\\n    xlab(\"Year\") + \\\n    ylab(\"Average Salary (USD)\") + \\\n    theme_minimal()\n\n```\n\n---\n\n## STRETCH QUESTION|TASK 1\n\n__Advanced Salary Distribution by Position (with Case Statement):__  \n\n    * Write an SQL query that provides a summary table showing the average salary for each position (e.g., pitcher, catcher, outfielder). Position information can be found in the fielding table in the POS column. \n    \n        Include the following columns:\n\n        * position\n        * average_salary\n        * total_players\n        * highest_salary  \n\n    * The highest_salary column should display the highest salary ever earned by a player in that position. \n\n    * Additionally, create a new column called salary_category using a case statement:  \n\n        * If the average salary is above $3 million, categorize it as “High Salary.”\n        * If the average salary is between $2 million and $3 million, categorize it as “Medium Salary.”\n        * Otherwise, categorize it as “Low Salary.”  \n\n    * Order the table by average salary in descending order.\n\n    **Hint:** Beware, it is common for a player to play multiple positions in a single year. For this analysis, each player’s salary should only be counted toward one position in a given year: the position at which they played the most games that year. This will likely require a (sub-query)[https://docs.data.world/documentation/sql/concepts/advanced/WITH.html].\n\n    \n\n_type your results and analysis here_\n\n```{python}\n# Include and execute your code here\nsalary_by_position_query = \"\"\"\nWITH PrimaryPosition AS (\n    SELECT \n        playerID,\n        yearID,\n        POS,\n        MAX(G) AS games_played\n    FROM (\n        SELECT \n            playerID, \n            yearID, \n            POS, \n            SUM(G) AS G\n        FROM \n            Fielding\n        GROUP BY \n            playerID, yearID, POS\n    )\n    GROUP BY \n        playerID, yearID\n    HAVING \n        G = MAX(G)\n),\n\nPositionSalary AS (\n    SELECT \n        pp.POS AS position,\n        s.playerID,\n        s.salary\n    FROM \n        Salaries s\n    JOIN \n        PrimaryPosition pp ON s.playerID = pp.playerID AND s.yearID = pp.yearID\n)\n\nSELECT \n    position,\n    ROUND(AVG(salary), 2) AS average_salary,\n    COUNT(DISTINCT playerID) AS total_players,\n    MAX(salary) AS highest_salary,\n    CASE \n        WHEN AVG(salary) > 3000000 THEN 'High Salary'\n        WHEN AVG(salary) BETWEEN 2000000 AND 3000000 THEN 'Medium Salary'\n        ELSE 'Low Salary'\n    END AS salary_category\nFROM \n    PositionSalary\nGROUP BY \n    position\nORDER BY \n    average_salary DESC;\n\"\"\"\n\ndf_salary_by_position = pd.read_sql_query(salary_by_position_query, con)\ndf_salary_by_position\n\n\n```\n\n\n## STRETCH QUESTION|TASK 2\n\n__Advanced Career Longevity and Performance (with Subqueries):__\n\n    * Calculate the average career length (in years) for players who have played at least **10 games**. Then, identify the top 10 players with the longest careers (based on the number of years they played). Include their: \n\n        * playerID\n        * first_name\n        * last_name\n        * career_length\n\n    * The career_length should be calculated as the difference between the maximum and minimum yearID for each player.  \n\n_type your results and analysis here_\n\n```{python}\ncareer_query = \"\"\"\nWITH CareerSpan AS (\n    SELECT \n        a.playerID,\n        MIN(a.yearID) AS start_year,\n        MAX(a.yearID) AS end_year,\n        (MAX(a.yearID) - MIN(a.yearID) + 1) AS career_length,\n        SUM(a.G_all) AS total_games\n    FROM \n        Appearances a\n    GROUP BY \n        a.playerID\n    HAVING \n        total_games >= 10\n),\n\nTopCareers AS (\n    SELECT \n        cs.playerID,\n        p.nameFirst AS first_name,\n        p.nameLast AS last_name,\n        cs.career_length\n    FROM \n        CareerSpan cs\n    JOIN \n        People p ON cs.playerID = p.playerID\n    ORDER BY \n        cs.career_length DESC\n    LIMIT 10\n)\n\nSELECT \n    * \nFROM \n    TopCareers;\n\"\"\"\n\ndf_top_careers = pd.read_sql_query(career_query, con)\ndf_top_careers\n\n\n```\n\n```{python}\navg_career_query = \"\"\"\nWITH CareerSpan AS (\n    SELECT \n        playerID,\n        MIN(yearID) AS start_year,\n        MAX(yearID) AS end_year,\n        (MAX(yearID) - MIN(yearID) + 1) AS career_length,\n        SUM(G_all) AS total_games\n    FROM \n        Appearances\n    GROUP BY \n        playerID\n    HAVING \n        total_games >= 10\n)\n\nSELECT \n    ROUND(AVG(career_length), 2) AS avg_career_length\nFROM \n    CareerSpan;\n\"\"\"\n\ndf_avg_career = pd.read_sql_query(avg_career_query, con)\ndf_avg_career\n```\n---\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":{"source":false,"toggle":true,"caption":"See code"},"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"self-contained":true,"toc-depth":3,"number-sections":false,"html-math-method":"katex","output-file":"P2_template.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","theme":{"light":"flatly","dark":"darkly"},"title":"Client Report - Finding Relationships in Baseball","subtitle":"Course DS 250","author":"[Maia Faith Chambers]","page-layout":"full","title-block-banner":true,"toc-location":"body","code-summary":"Show the code","code-copy":"hover"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}